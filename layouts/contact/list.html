{{ define "main" }}

{{ .Content }}

<div class="container">
  <!-- Success message (shown after successful submission) -->
  <div id="success-message" class="alert alert-success d-none" role="alert">
    <h4 class="alert-heading">Thank you!</h4>
    <p id="success-message-text">Your message has been sent successfully. We'll get back to you as soon as possible.</p>
  </div>

  <!-- Error message (shown if submission fails) -->
  <div id="error-message" class="alert alert-danger d-none" role="alert">
    <h4 class="alert-heading">Submission failed</h4>
    <p id="error-message-text">There was an issue with your submission. Please try again.</p>
  </div>

  <!-- Contact form container -->
  <div id="contact-form-container">
    <form id="contact-form" class="needs-validation" novalidate>
      <div class="row mb-3 mt-2">
        <label for="name" class="col-sm-2 col-form-label fw-bold">Your name*:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="name" name="name" required>
        </div>
      </div>
      <div class="row mb-3">
        <label for="email" class="col-sm-2 col-form-label fw-bold">Your email*:</label>
        <div class="col-sm-10">
          <input type="email" class="form-control" id="email" name="email" required>
        </div>
      </div>
      
      {{/* Honeypot fields for anti-bot protection, referred to as 'additional fields' in production code */}}
      <div class="row mb-3" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" aria-hidden="true">
        <label for="website" class="col-sm-2 col-form-label">Website:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="website" name="website" tabindex="-1" autocomplete="off">
        </div>
      </div>
      
      <div class="row mb-3" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" aria-hidden="true">
        <label for="phone_number" class="col-sm-2 col-form-label">Phone:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="phone_number" name="phone_number" tabindex="-1" autocomplete="off">
        </div>
      </div>
      
      <div class="row mb-3" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" aria-hidden="true">
        <label for="company" class="col-sm-2 col-form-label">Company:</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="company" name="company" tabindex="-1" autocomplete="off">
        </div>
      </div>
      
      <!-- Message field -->
      <div class="row mb-3">
        <label for="message" class="col-sm-2 col-form-label fw-bold">Message:*</label>
        <div class="col-sm-10">
          <textarea class="form-control" id="message" name="message" rows="5" required></textarea>
        </div>
      </div>
      
      <!-- reCAPTCHA - commented out to test anti-spam -->
      <!-- <div class="g-recaptcha" data-sitekey="6LdPd50fAAAAAJ_dVMXFJjzOTh7XZeAI-ej82GPv"></div> -->
      <!-- <label id="g-recaptcha" for="url"> -->
      
      <button type="button" class="btn btn-aqua mt-2" id="submit-btn" onclick="submitContactForm()">Send</button>
    </form>
  </div>
</div>

<script>
  // Initialise session tracking for anti-spam
  var sessionStartTime = Date.now();
  var sessionId = generateSessionId('contact');

  // Prevent form submission if user presses Enter
  preventEnterSubmission('contact-form');

  function submitContactForm() {
    // Validate form-specific fields
    if (!validateContactForm()) {
      return;
    }

    // Validate common submission criteria
    if (!validateCommonSubmission(sessionStartTime)) {
      showContactError('Form submission failed validation. Please try again.');
      return;
    }

    // reCAPTCHA validation - commented out to test anti-spam
    /*
    var recaptcha = $("#g-recaptcha-response").val();
    if (recaptcha === "") {
      showContactError("Please tick 'I'm not a robot' above the 'Submit' button.");
      return;
    }
    */

    // Show loading state
    setButtonLoadingState('submit-btn', true, 'Sending...');

    // Hide any previous messages
    hideFormMessage('success-message');
    hideFormMessage('error-message');

    // Collect form-specific data
    var formData = new FormData();
    formData.append('name', document.getElementById('name').value);
    formData.append('email', document.getElementById('email').value);
    formData.append('message', document.getElementById('message').value);

    // Add common metadata
    addFormMetadata(formData, 'contact', sessionId, sessionStartTime);

    // reCAPTCHA data - commented out to test anti-spam
    /*
    var recaptchaResponse = $("#g-recaptcha-response").val();
    if (recaptchaResponse) {
      formData.append('g-recaptcha-response', recaptchaResponse);
    }
    */

    // Submit using common function
    submitFormData(formData, showContactSuccess, showContactError)
    .finally(() => {
      setButtonLoadingState('submit-btn', false);
    });
  }

  // Form-specific validation
  function validateContactForm() {
    var name = document.getElementById('name').value.trim();
    var email = document.getElementById('email').value.trim();
    var message = document.getElementById('message').value.trim();

    if (!name || !email || !message) {
      alert("Please fill out all required fields.");
      return false;
    }

    if (!validateEmail(email)) {
      alert("Please enter a valid email address.");
      return false;
    }

    return true;
  }

  function showContactSuccess(message) {
    showFormMessage('success-message', message);
    document.getElementById('contact-form-container').classList.add('d-none');
  }

  function showContactError(message) {
    showFormMessage('error-message', message, false);
  }
</script>
{{ end }}
